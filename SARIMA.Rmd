---
title: "SARIMA"
author: "Eliza"
date: "2024-03-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message = FALSE)
```

### Load Packages
```{r}
library(sarima)
library(tidyverse)
library(lubridate)
library(forecast)
```
# TRAIN
## Restructuring Data
```{r}
# Passenger Volume for Trains - By Origin Destination (2023 Dec)
pv_train_od_202312 <- read.csv("../PV Data [Buses and Trains]/Trains/By OD/origin_destination_train_202312.csv")

# Passenger Volume for Trains - By Origin Destination (2024 Jan)
pv_train_od_202401 <- read.csv("../PV Data [Buses and Trains]/Trains/By OD/origin_destination_train_202401.csv")

# Passenger Volume for Trains - By Origin Destination (2024 Feb)
pv_train_od_202402 <- read.csv("../PV Data [Buses and Trains]/Trains/By OD/origin_destination_train_202402.csv")


# combine data from Dec 2023 - Feb 2024 of passenger volume for trains with origin destinations
pv_train_od = rbind(pv_train_od_202312,pv_train_od_202401,pv_train_od_202402)

# change class of date to Date
pv_train_od = pv_train_od %>%
  mutate(YEAR_MONTH = as.Date(paste(YEAR_MONTH,"01",sep = "-"))) %>%
  mutate(trip = str_c(ORIGIN_PT_CODE, DESTINATION_PT_CODE, sep="-"))

pv_train_od$ds = pv_train_od$YEAR_MONTH
# Combine date and hour
pv_train_od$ds <- as.POSIXct(paste(pv_train_od$ds, pv_train_od$TIME_PER_HOUR), format = "%Y-%m-%d %H")

pv_train_od = pv_train_od %>%
  select(-YEAR_MONTH) %>%
  select(-TIME_PER_HOUR) %>%
  select(-PT_TYPE)
```

```{r}
ts_data <- ts(pv_train_od$TOTAL_TRIPS, frequency = 24) #change to time series with hourly seasonality
# Fit the SARIMA model
fit <- auto.arima(ts_data, seasonal = TRUE)
```
